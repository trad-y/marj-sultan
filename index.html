<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø±Ø¬ Ø§Ù„Ø³Ù„Ø·Ø§Ù† | Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --gold: #d4af37;
            --gold-light: rgba(212, 175, 55, 0.2);
            --bg: #050505;
            --card: #111;
            --input-bg: #151515;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --green: #2ecc71;
            --orange: #e67e22;
            --red: #e74c3c;
            --blue: #3498db;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Tajawal', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { background-color: var(--bg); color: #fff; overflow-x: hidden; line-height: 1.6; }

        /* --- Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ø£ØµØºØ± Ø­Ø¬Ù…) --- */
        #status-bar { 
            position: fixed; top: 10px; left: 50%; transform: translateX(-50%); 
            background: rgba(0,0,0,0.98); border: 1.5px solid var(--gold); 
            padding: 8px 20px; border-radius: 30px; display: none; z-index: 11000;
            box-shadow: 0 4px 20px rgba(212,175,55,0.3); backdrop-filter: blur(10px);
            text-align: center; min-width: 250px; max-width: 90%;
            animation: fadeInDown 0.4s ease;
            font-size: 0.9rem;
        }
        
        #status-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
        }
        
        #status-text {
            color: var(--gold); 
            font-weight: bold;
            font-size: 0.85rem;
        }
        
        #status-id {
            font-size: 0.65rem;
            opacity: 0.7;
        }
        
        #status-timer {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--green);
            font-family: monospace;
            margin-top: 2px;
        }
        
        .status-icon {
            margin-left: 5px;
        }
        
        @keyframes fadeInDown {
            from { opacity: 0; transform: translate(-50%, -15px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ø¨Ø­Ø« --- */
        .hero { 
            padding: 35px 20px 20px; 
            text-align: center; 
            background: linear-gradient(to bottom, #111, var(--bg));
            position: relative;
        }
        
        .hero h1 { 
            font-size: 2.5rem; 
            color: var(--gold); 
            font-weight: 900; 
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .hero p.subtitle { 
            color: var(--gold); 
            font-size: 0.65rem; 
            letter-spacing: 2px; 
            margin-bottom: 15px;
        }
        
        /* Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ ØµØºÙŠØ±Ø© ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ */
        .connection-status {
            position: absolute;
            top: 10px;
            right: 15px;
            background: rgba(0,0,0,0.6);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            gap: 6px;
            z-index: 1000;
            border: 1px solid rgba(46, 204, 113, 0.2);
        }
        
        .connection-status.connected {
            color: var(--green);
        }
        
        .connection-status.disconnected {
            color: var(--red);
            border-color: rgba(231, 76, 60, 0.2);
        }
        
        .search-box { max-width: 500px; margin: 10px auto; padding: 0 20px; }
        .search-box input { 
            width: 100%; padding: 14px 18px; border-radius: 12px; border: 1px solid #333; 
            background: var(--card); color: #fff; text-align: center; font-size: 1rem;
            transition: var(--transition);
        }
        .search-box input:focus { border-color: var(--gold); background: #181818; box-shadow: 0 0 10px rgba(212,175,55,0.2); }

        /* --- Ø§Ù„Ù…Ù†ÙŠÙˆ (3 Ø£Ø¹Ù…Ø¯Ø©) --- */
        .container { padding: 0 12px 100px; max-width: 1200px; margin: 0 auto; }
        .category-title { 
            color: var(--gold); font-size: 1.3rem; margin: 25px 0 12px; 
            border-right: 4px solid var(--gold); padding-right: 12px; 
            position: relative; display: inline-block;
        }
        .menu-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        
        .item-card { 
            background: var(--card); border-radius: 15px; overflow: hidden; 
            aspect-ratio: 1/1.3; border: 1px solid rgba(255,255,255,0.05); 
            cursor: pointer; transition: var(--transition); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .item-card:active { transform: scale(0.97); }
        .item-card img { width: 100%; height: 60%; object-fit: cover; opacity: 0.9; }
        .item-info { padding: 10px 8px; }
        .item-name { font-size: 0.8rem; font-weight: bold; display: block; height: 34px; overflow: hidden; line-height: 1.3; }
        .item-price { color: var(--gold); font-weight: 900; font-size: 0.9rem; display: block; margin-top: 4px; }

        /* --- Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© --- */
        #quick-cart {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gold);
            color: #000;
            padding: 12px 30px;
            border-radius: 40px;
            font-weight: 900;
            display: none;
            z-index: 9000;
            box-shadow: 0 8px 25px rgba(0,0,0,0.6);
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid rgba(0,0,0,0.1);
            font-size: 1rem;
        }
        #quick-cart:active { transform: translateX(-50%) scale(0.95); }

        /* --- Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø§Ù„Ø¨Ø³ÙŠØ·Ø© --- */
        #simple-order-form {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.98);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(8px);
            animation: fadeIn 0.3s;
        }
        
        .simple-modal {
            background: #0d0d0d;
            width: 90%;
            max-width: 380px;
            border-radius: 18px;
            padding: 22px;
            border: 1px solid #222;
            box-shadow: 0 15px 40px rgba(0,0,0,0.7);
        }
        
        .simple-input {
            width: 100%;
            padding: 13px;
            background: var(--input-bg);
            border: 1px solid #252525;
            color: #fff;
            border-radius: 10px;
            font-size: 0.95rem;
            margin-bottom: 12px;
            text-align: center;
        }
        
        .simple-input:focus {
            outline: none;
            border-color: var(--gold);
        }
        
        /* --- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… --- */
        .btn-submit { 
            background: var(--gold); color: #000; font-weight: 900; padding: 14px; 
            border-radius: 10px; border: none; width: 100%; font-size: 1rem; 
            cursor: pointer; margin-top: 8px; transition: all 0.2s;
        }
        .btn-submit:active { transform: scale(0.98); }
        
        /* --- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµØºÙŠØ± --- */
        .mini-loader {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #333;
            border-top: 2px solid var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 5px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* --- Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø© --- */
        .quick-notification {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gold);
            color: #000;
            padding: 10px 20px;
            border-radius: 40px;
            font-weight: 700;
            z-index: 10000;
            display: none;
            box-shadow: 0 8px 25px rgba(212,175,55,0.3);
            animation: slideUp 0.3s;
            font-size: 0.85rem;
        }
        
        @keyframes slideUp {
            from { transform: translate(-50%, 80px); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        
        /* --- ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© --- */
        @media (max-width: 768px) {
            .menu-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; }
            .hero h1 { font-size: 2rem; }
            .hero { padding: 30px 15px 15px; }
            .container { padding: 0 10px 90px; }
            #status-bar { max-width: 95%; padding: 7px 15px; }
        }
        
        @media (max-width: 480px) {
            .menu-grid { grid-template-columns: 1fr; gap: 8px; }
            .item-card { aspect-ratio: 1/1.2; }
        }
    </style>
</head>
<body>

    <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„ØµØºÙŠØ±Ø© -->
    <div class="connection-status connected" id="connection-status">
        <i class="fas fa-circle" style="font-size: 0.6rem;"></i>
        <span>Ù…ØªØµÙ„</span>
    </div>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø§Ù„ØµØºÙŠØ± -->
    <div id="status-bar">
        <div id="status-content">
            <div id="status-text">
                <span id="status-icon" class="status-icon"></span>
                <span id="status-message">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...</span>
            </div>
            <div id="status-id"></div>
            <div id="status-timer"></div>
        </div>
    </div>

    <header class="hero">
        <h1>Ù…Ø±Ø¬ Ø§Ù„Ø³Ù„Ø·Ø§Ù†</h1>
        <p class="subtitle">PREMIUM SYSTEM</p>
        <div class="search-box">
            <input type="text" id="mainSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙˆØ¬Ø¨ØªÙƒ Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø²..." onkeyup="checkTrad(this.value)">
        </div>
    </header>

    <main class="container" id="menuView"></main>

    <!-- Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
    <div id="quick-cart" onclick="showSimpleOrderForm()">
        <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ (<span id="cart-count">0</span>)
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¨Ø³ÙŠØ· -->
    <div id="simple-order-form">
        <div class="simple-modal">
            <h2 style="color:var(--gold); text-align:center; margin-bottom:15px; font-size:1.3rem;">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h2>
            
            <input type="text" class="simple-input" id="simple-name" placeholder="Ø§Ù„Ø§Ø³Ù…" autocomplete="off">
            <input type="tel" class="simple-input" id="simple-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" autocomplete="off">
            
            <div style="margin: 12px 0; text-align:center;">
                <label style="display:inline-flex; align-items:center; gap:6px; cursor:pointer; font-size:0.9rem;">
                    <input type="checkbox" id="simple-delivery" style="width:16px; height:16px; accent-color:var(--gold);">
                    <span>ØªÙˆØµÙŠÙ„</span>
                </label>
            </div>
            
            <div id="delivery-address" style="display:none;">
                <input type="text" class="simple-input" id="simple-address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" autocomplete="off">
            </div>
            
            <button class="btn-submit" onclick="sendOrderDirectly()">
                <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¢Ù†
            </button>
            
            <button onclick="closeSimpleForm()" style="width:100%; background:none; border:none; color:#777; margin-top:12px; padding:8px; cursor:pointer; font-size:0.9rem;">
                Ø¥Ù„ØºØ§Ø¡
            </button>
        </div>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (TRAD) -->
    <div id="admin-panel" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:20000; padding:15px; overflow-y:auto;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h1 style="color:var(--gold); font-size:1.5rem;">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ÙŠÙˆ</h1>
            <button onclick="saveAndCloseAdmin()" style="padding:8px 16px; background:var(--gold); border:none; border-radius:8px; font-weight:bold; cursor:pointer; font-size:0.9rem;">Ø­ÙØ¸ ÙˆØ¥ØºÙ„Ø§Ù‚</button>
        </div>
        <div id="adminContainer"></div>
    </div>

    <!-- Ø¥Ø´Ø¹Ø§Ø± Ø³Ø±ÙŠØ¹ -->
    <div id="quick-notification" class="quick-notification"></div>

    <script>
        // --- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø§ØªØµØ§Ù„ ---
        let db = JSON.parse(localStorage.getItem('sultan_final_v3')) || [
            { 
                category: "Ø§Ù„ÙˆØ¬Ø¨Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ø§Ù‹", 
                items: [
                    { id: 1, name: "Ø´Ø§ÙˆØ±Ù…Ø§ Ù…Ù„ÙƒÙŠ Ø¯Ø¨Ù„", price: "4.50", img: "https://images.unsplash.com/photo-1529006557810-274b9b2fc783?w=500", desc: "Ù„Ø­Ù… Ø·Ø§Ø²Ø¬ØŒ Ø«ÙˆÙ…ÙŠØ©ØŒ Ø¨Ø·Ø§Ø·Ø³ØŒ Ø®Ø¶Ø§Ø±", time: "12 Ø¯" },
                    { id: 2, name: "Ø¨Ø±ØºØ± Ù…Ù„ÙƒÙŠ", price: "5.00", img: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=500", desc: "Ù„Ø­Ù… Ø¨Ù‚Ø±ÙŠØŒ Ø¬Ø¨Ù†Ø©ØŒ Ø®Ø³ØŒ Ø·Ù…Ø§Ø·Ù…", time: "15 Ø¯" },
                    { id: 3, name: "Ø¯Ø¬Ø§Ø¬ Ù…Ø´ÙˆÙŠ", price: "3.75", img: "https://images.unsplash.com/photo-1532550907401-a500c9a57435?w=500", desc: "Ø¯Ø¬Ø§Ø¬ Ù…Ø´ÙˆÙŠ Ù…Ø¹ Ø£Ø±Ø² ÙˆØ®Ø¶Ø§Ø±", time: "18 Ø¯" }
                ] 
            }
        ];
        
        let cart = [];
        let socket;
        let isConnected = false;
        let activeTimer = null;
        let currentOrderId = null;

        // --- Ø§ØªØµØ§Ù„ WebSocket ---
        function connectToServer() {
            try {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… wss Ù„Ù€ GitHub Pages Ø£Ùˆ ws Ù„Ù„Ù…Ø­Ù„ÙŠ
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const host = window.location.hostname === 'localhost' ? '192.168.1.101:8080' : window.location.host;
                const wsUrl = `${protocol}//${host}`;
                
                console.log(`ğŸ”— Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„: ${wsUrl}`);
                socket = new WebSocket(wsUrl);
                
                socket.onopen = function() {
                    console.log("âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±");
                    isConnected = true;
                    updateConnectionStatus(true);
                };
                
                socket.onmessage = function(e) {
                    try {
                        const data = JSON.parse(e.data);
                        console.log("ğŸ“¥ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±:", data);
                        
                        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø±Ø¯ Ø§Ù„Ø³ÙŠØ±ÙØ±
                        if (data.orderID && (data.status || data.type)) {
                            updateStatusFromServer(data);
                        }
                    } catch (err) {
                        console.log("ğŸ“¨ Ø±Ø³Ø§Ù„Ø© Ù†ØµÙŠØ©:", e.data);
                    }
                };
                
                socket.onerror = function(error) {
                    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:", error);
                    isConnected = false;
                    updateConnectionStatus(false);
                };
                
                socket.onclose = function() {
                    console.log("ğŸ”Œ ØªÙ… Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„");
                    isConnected = false;
                    updateConnectionStatus(false);
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
                    setTimeout(() => {
                        console.log("ğŸ”„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„...");
                        connectToServer();
                    }, 3000);
                };
                
            } catch (err) {
                console.error("âŒ ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„:", err);
                isConnected = false;
                updateConnectionStatus(false);
                
                setTimeout(() => {
                    connectToServer();
                }, 5000);
            }
        }
        
        function updateConnectionStatus(connected) {
            const statusEl = document.getElementById('connection-status');
            if (connected) {
                statusEl.className = 'connection-status connected';
                statusEl.innerHTML = '<i class="fas fa-circle" style="font-size: 0.6rem;"></i><span>Ù…ØªØµÙ„</span>';
            } else {
                statusEl.className = 'connection-status disconnected';
                statusEl.innerHTML = '<i class="fas fa-circle" style="font-size: 0.6rem;"></i><span>Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„...</span>';
            }
        }

        // --- ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± ---
        function updateStatusFromServer(data) {
            const bar = document.getElementById('status-bar');
            const message = document.getElementById('status-message');
            const icon = document.getElementById('status-icon');
            const id = document.getElementById('status-id');
            const timer = document.getElementById('status-timer');
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ø´Ø±ÙŠØ·
            bar.style.display = 'block';
            bar.style.animation = 'fadeInDown 0.4s ease';
            
            // Ø­ÙØ¸ Ù…Ø¹Ø±Ù Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
            currentOrderId = data.orderID || data.orderId;
            
            // ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
            if (data.status === 'received' || data.type === 'order_received') {
                icon.innerHTML = 'ğŸ“¥';
                message.textContent = 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ';
                id.textContent = '#' + currentOrderId;
                timer.textContent = 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯...';
                timer.style.color = 'var(--blue)';
                
            } else if (data.status === 'preparing' || data.type === 'order_preparing') {
                icon.innerHTML = 'ğŸ‘¨â€ğŸ³';
                message.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±';
                id.textContent = '#' + currentOrderId;
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ÙˆÙ‚Øª ØªÙ‚Ø¯ÙŠØ±ÙŠØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
                if (data.estimatedTime || data.time) {
                    const minutes = data.estimatedTime || data.time || 13;
                    startCountdown(minutes);
                    timer.textContent = `â± ${minutes}:00`;
                } else {
                    timer.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¬Ù‡ÙŠØ²...';
                }
                timer.style.color = 'var(--orange)';
                
            } else if (data.status === 'ready' || data.type === 'order_ready') {
                icon.innerHTML = 'âœ…';
                message.textContent = 'Ø§Ù„Ø·Ù„Ø¨ Ø¬Ø§Ù‡Ø²';
                id.textContent = '#' + currentOrderId;
                timer.textContent = 'Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…';
                timer.style.color = 'var(--green)';
                
                // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
                stopCountdown();
                
            } else if (data.status === 'rejected' || data.type === 'order_rejected') {
                icon.innerHTML = 'âŒ';
                message.textContent = 'Ù„Ù… ÙŠØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨';
                id.textContent = '#' + currentOrderId;
                timer.textContent = 'ØªÙ… Ø§Ù„Ø±ÙØ¶';
                timer.style.color = 'var(--red)';
                
                // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
                stopCountdown();
            }
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø±ÙŠØ· Ø¨Ø¹Ø¯ 8 Ø«ÙˆØ§Ù†ÙŠ (Ù…Ø§Ø¹Ø¯Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙŠÙ‡ Ø¹Ø¯ ØªÙ†Ø§Ø²Ù„ÙŠ Ù†Ø´Ø·)
            if (!activeTimer) {
                setTimeout(() => {
                    hideStatusBar();
                }, 8000);
            }
        }

        // --- Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ ---
        function startCountdown(minutes) {
            stopCountdown(); // ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ø¹Ø¯ ØªÙ†Ø§Ø²Ù„ÙŠ Ø³Ø§Ø¨Ù‚
            
            let totalSeconds = minutes * 60;
            const timer = document.getElementById('status-timer');
            
            activeTimer = setInterval(() => {
                const mins = Math.floor(totalSeconds / 60);
                const secs = totalSeconds % 60;
                
                timer.textContent = `â± ${mins}:${secs < 10 ? '0' : ''}${secs}`;
                
                // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø¹Ù†Ø¯ Ø§Ù‚ØªØ±Ø§Ø¨ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
                if (totalSeconds <= 300) { // 5 Ø¯Ù‚Ø§Ø¦Ù‚
                    timer.style.color = 'var(--orange)';
                }
                if (totalSeconds <= 60) { // Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©
                    timer.style.color = 'var(--red)';
                }
                
                if (totalSeconds <= 0) {
                    stopCountdown();
                    timer.textContent = 'â° Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª';
                    timer.style.color = 'var(--red)';
                }
                
                totalSeconds--;
            }, 1000);
        }

        function stopCountdown() {
            if (activeTimer) {
                clearInterval(activeTimer);
                activeTimer = null;
            }
        }

        function hideStatusBar() {
            const bar = document.getElementById('status-bar');
            bar.style.animation = 'fadeInDown 0.4s ease reverse';
            setTimeout(() => {
                bar.style.display = 'none';
                currentOrderId = null;
            }, 400);
        }

        // --- Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ---
        function renderMenu(filter = "") {
            const view = document.getElementById('menuView');
            view.innerHTML = "";
            
            db.forEach(cat => {
                const items = cat.items.filter(i => 
                    i.name.includes(filter) || 
                    (i.desc && i.desc.includes(filter))
                );
                
                if(items.length === 0) return;
                
                let html = `<h2 class="category-title">${cat.category}</h2><div class="menu-grid">`;
                
                items.forEach(item => {
                    html += `
                        <div class="item-card" onclick="addToCart(${item.id})">
                            <img src="${item.img || 'https://via.placeholder.com/150'}" alt="${item.name}">
                            <div class="item-info">
                                <span class="item-name">${item.name}</span>
                                <span class="item-price">${item.price} Ø¯.Ø£</span>
                            </div>
                        </div>
                    `;
                });
                
                view.innerHTML += html + `</div>`;
            });
        }

        function addToCart(id) {
            let item;
            db.forEach(c => c.items.forEach(i => { if(i.id == id) item = i; }));
            
            if(!item) return;
            
            cart.push(item);
            updateCartDisplay();
            showQuickNotification("+" + item.name);
        }

        function updateCartDisplay() {
            const count = cart.length;
            document.getElementById('cart-count').textContent = count;
            document.getElementById('quick-cart').style.display = count > 0 ? 'block' : 'none';
        }

        // --- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¨Ø³ÙŠØ· ---
        function showSimpleOrderForm() {
            if (cart.length === 0) {
                showQuickNotification("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©");
                return;
            }
            
            document.getElementById('simple-order-form').style.display = 'flex';
            document.getElementById('simple-name').focus();
        }

        function closeSimpleForm() {
            document.getElementById('simple-order-form').style.display = 'none';
            document.getElementById('simple-delivery').checked = false;
            document.getElementById('delivery-address').style.display = 'none';
        }

        document.getElementById('simple-delivery').addEventListener('change', function() {
            document.getElementById('delivery-address').style.display = this.checked ? 'block' : 'none';
        });

        // --- Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø© ---
        function sendOrderDirectly() {
            const name = document.getElementById('simple-name').value.trim();
            const phone = document.getElementById('simple-phone').value.trim();
            const isDelivery = document.getElementById('simple-delivery').checked;
            const address = document.getElementById('simple-address').value.trim();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            if (!name || !phone) {
                showQuickNotification("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù‡Ø§ØªÙ");
                return;
            }
            
            if (!phone.match(/^07[0-9]{8}$/)) {
                showQuickNotification("Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­");
                return;
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù Ø§Ù„Ø·Ù„Ø¨
            const orderId = "MS-" + Date.now().toString().slice(-8);
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨
            const orderData = {
                type: 'new_order',
                orderID: orderId,
                customer: name,
                phone: phone,
                items: cart,
                address: isDelivery ? (address || "ØªÙˆØµÙŠÙ„") : "Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„ÙØ±Ø¹",
                isDelivery: isDelivery,
                timestamp: new Date().toISOString(),
                total: calculateTotal()
            };
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
            const bar = document.getElementById('status-bar');
            const message = document.getElementById('status-message');
            const icon = document.getElementById('status-icon');
            const id = document.getElementById('status-id');
            const timer = document.getElementById('status-timer');
            
            icon.innerHTML = 'ğŸ“¤';
            message.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
            id.textContent = '#' + orderId;
            timer.textContent = '';
            timer.style.color = 'var(--gold)';
            bar.style.display = 'block';
            bar.style.animation = 'fadeInDown 0.4s ease';
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
            if (isConnected && socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify(orderData));
                console.log("ğŸ“¤ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨:", orderData);
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆÙ…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©
                closeSimpleForm();
                cart = [];
                updateCartDisplay();
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
                document.getElementById('simple-name').value = '';
                document.getElementById('simple-phone').value = '';
                document.getElementById('simple-address').value = '';
                document.getElementById('simple-delivery').checked = false;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠØ· Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ© (Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±)
                setTimeout(() => {
                    icon.innerHTML = 'â³';
                    message.textContent = 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯...';
                    timer.textContent = 'Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨';
                    timer.style.color = 'var(--blue)';
                }, 1500);
                
                // Ø§Ù„Ø´Ø±ÙŠØ· ÙŠØ¨Ù‚Ù‰ Ù…ÙØªÙˆØ­Ø§Ù‹ Ø­ØªÙ‰ ÙŠØ£ØªÙŠ Ø±Ø¯ Ø§Ù„Ø³ÙŠØ±ÙØ±
                
            } else {
                showQuickNotification("ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø§ØªØµØ§Ù„");
                bar.style.display = 'none';
            }
        }

        function calculateTotal() {
            return cart.reduce((sum, item) => {
                const price = parseFloat(item.price) || 0;
                return sum + price;
            }, 0).toFixed(2);
        }

        // --- Ø¥Ø¯Ø§Ø±Ø© TRAD ---
        function checkTrad(val) {
            if(val.toLowerCase() === 'trad') {
                document.getElementById('admin-panel').style.display = 'block';
                renderAdmin();
            } else {
                renderMenu(val);
            }
        }

        function renderAdmin() {
            const container = document.getElementById('adminContainer');
            container.innerHTML = db.map((cat, cIdx) => `
                <div style="background:#111; padding:15px; border-radius:12px; margin-bottom:15px; border:1px solid #222;">
                    <input class="simple-input" style="color:var(--gold); font-weight:bold; margin-bottom:12px; font-size:1rem;" 
                           value="${cat.category}" 
                           onchange="db[${cIdx}].category=this.value">
                    
                    ${cat.items.map((item, iIdx) => `
                        <div style="background:#000; padding:12px; border-radius:10px; margin-top:8px; border:1px solid #333;">
                            <input class="simple-input" style="margin-bottom:6px; font-size:0.9rem;" value="${item.name}" 
                                   onchange="db[${cIdx}].items[${iIdx}].name=this.value">
                            <input class="simple-input" style="margin-bottom:6px; font-size:0.9rem;" value="${item.price}" 
                                   onchange="db[${cIdx}].items[${iIdx}].price=this.value">
                            <input class="simple-input" style="margin-bottom:6px; font-size:0.9rem;" value="${item.img}" 
                                   onchange="db[${cIdx}].items[${iIdx}].img=this.value" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
                            <input class="simple-input" style="margin-bottom:8px; font-size:0.9rem;" value="${item.time || '10 Ø¯'}" 
                                   onchange="db[${cIdx}].items[${iIdx}].time=this.value" placeholder="ÙˆÙ‚Øª Ø§Ù„ØªØ¬Ù‡ÙŠØ²">
                            
                            <button onclick="db[${cIdx}].items.splice(${iIdx},1); renderAdmin()" 
                                    style="color:#ff4444; background:none; border:none; font-size:0.75rem; cursor:pointer; padding:4px 8px;">
                                <i class="fas fa-trash"></i> Ø­Ø°Ù
                            </button>
                        </div>
                    `).join('')}
                    
                    <button onclick="db[${cIdx}].items.push({id:Date.now(), name:'ÙˆØ¬Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©', price:'2.50', img:'', desc:'', time:'10 Ø¯'}); renderAdmin()" 
                            style="width:100%; margin-top:12px; background:#333; color:#fff; border:none; padding:10px; border-radius:8px; cursor:pointer; font-size:0.9rem;">
                        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ÙˆØ¬Ø¨Ø©
                    </button>
                </div>
            `).join('');
        }

        function saveAndCloseAdmin() {
            localStorage.setItem('sultan_final_v3', JSON.stringify(db));
            document.getElementById('admin-panel').style.display = 'none';
            document.getElementById('mainSearch').value = "";
            renderMenu();
            showQuickNotification("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ“");
        }

        // --- Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ---
        function showQuickNotification(message) {
            const notification = document.getElementById('quick-notification');
            notification.textContent = message;
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 1500);
        }

        // --- Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ ---
        window.onload = () => {
            renderMenu();
            connectToServer();
            
            // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ØµØ± ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø³Ù„Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
            setTimeout(() => {
                if (cart.length === 0 && db[0] && db[0].items[0]) {
                    cart.push(db[0].items[0]);
                    updateCartDisplay();
                }
            }, 1000);
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø¨Ø§Ù„Ø²Ø± Escape
            document.addEventListener('keydown', function(e) {
                if(e.key === 'Escape') {
                    closeSimpleForm();
                    document.getElementById('admin-panel').style.display = 'none';
                }
            });
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ÙŠÙ‡
            document.getElementById('simple-order-form').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeSimpleForm();
                }
            });
        };
    </script>
</body>
</html>
